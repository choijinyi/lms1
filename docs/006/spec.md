# UC-006: ì„±ì  & í”¼ë“œë°± ì—´ëŒ (Learner)

## Primary Actor
í•™ìŠµì (Learner)

## Precondition
- ì‚¬ìš©ìê°€ Learner ì—­í• ë¡œ ë¡œê·¸ì¸ëœ ìƒíƒœ
- ìˆ˜ê°• ì¤‘ì¸ ì½”ìŠ¤ ì¡´ì¬
- ì„±ì  í˜ì´ì§€(`/learner/grades` ë˜ëŠ” `/courses/[courseId]/grades`) ì ‘ê·¼

## Trigger
ì„±ì  í˜ì´ì§€ ì ‘ê·¼ ë˜ëŠ” ëŒ€ì‹œë³´ë“œì—ì„œ "ì„±ì  ë³´ê¸°" ë§í¬ í´ë¦­

## Main Scenario

1. ì‚¬ìš©ìê°€ ì„±ì  í˜ì´ì§€ ì ‘ê·¼ (`/learner/grades`)
2. FEê°€ BEì— ë‚´ ìˆ˜ê°• ëª©ë¡ ìš”ì²­ (`GET /api/enrollments/me`)
3. BEê°€ í˜„ì¬ ì‚¬ìš©ìì˜ í™œì„± ìˆ˜ê°• ëª©ë¡ ë°˜í™˜ (`canceled_at = null`)
4. FEê°€ ê° ì½”ìŠ¤ë³„ ê³¼ì œ ëª©ë¡ ìš”ì²­ (`GET /api/courses/:courseId/assignments?status=published,closed`)
5. FEê°€ ë‚´ ì œì¶œë¬¼ ëª©ë¡ ìš”ì²­ (`GET /api/submissions/me?status=graded`)
6. FEê°€ ê° ì œì¶œë¬¼ì˜ ì •ë³´ í‘œì‹œ:
   - ê³¼ì œëª…, ì½”ìŠ¤ëª…
   - ì ìˆ˜ (0-100)
   - í”¼ë“œë°± ë‚´ìš©
   - ì§€ê° ì—¬ë¶€ (`late` í•„ë“œ)
   - ì œì¶œ ì‹œê°, ì±„ì  ì‹œê°
7. FEê°€ ì½”ìŠ¤ë³„ ì´ì  ê³„ì‚°:
   - ì´ì  = Î£(ê³¼ì œ ì ìˆ˜ Ã— ê³¼ì œ ë¹„ì¤‘ / 100)
   - ì˜ˆ: ê³¼ì œ1(20% ë¹„ì¤‘, 90ì ) + ê³¼ì œ2(30% ë¹„ì¤‘, 85ì ) = (90 Ã— 0.2) + (85 Ã— 0.3) = 43.5ì 
8. FEê°€ ì„±ì  UI í‘œì‹œ:
   - **ì½”ìŠ¤ë³„ ì„±ì  ì„¹ì…˜**: ì½”ìŠ¤ëª…, ì´ì , ê³¼ì œ ê°œìˆ˜
   - **ê³¼ì œë³„ ì„±ì  ì„¹ì…˜**: ê³¼ì œëª…, ì ìˆ˜, ë¹„ì¤‘, ì§€ê° ì—¬ë¶€, í”¼ë“œë°±
   - **ì „ì²´ ìš”ì•½ ì„¹ì…˜**: í‰ê·  ì ìˆ˜, ì œì¶œ ì™„ë£Œ ê³¼ì œ ìˆ˜

## Edge Cases

### 1. ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ì
- **ìƒí™©**: ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìê°€ ì„±ì  í˜ì´ì§€ ì ‘ê·¼ ì‹œë„
- **ì²˜ë¦¬**: `401 Unauthorized`, ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸

### 2. Instructorê°€ Learner ì„±ì  í˜ì´ì§€ ì ‘ê·¼
- **ìƒí™©**: Instructor ì—­í• ë¡œ Learner ì„±ì  í˜ì´ì§€ ì ‘ê·¼ ì‹œë„
- **ì²˜ë¦¬**: `403 Forbidden` ë˜ëŠ” Instructor ëŒ€ì‹œë³´ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸

### 3. ìˆ˜ê°• ì¤‘ì¸ ì½”ìŠ¤ê°€ ì—†ìŒ
- **ìƒí™©**: enrollmentê°€ ì—†ê±°ë‚˜ ëª¨ë‘ ì·¨ì†Œë¨
- **ì²˜ë¦¬**: "ìˆ˜ê°• ì¤‘ì¸ ì½”ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. ì½”ìŠ¤ë¥¼ íƒìƒ‰í•´ë³´ì„¸ìš”." ë©”ì‹œì§€ + ì½”ìŠ¤ ì¹´íƒˆë¡œê·¸ ë§í¬ í‘œì‹œ

### 4. ì œì¶œë¬¼ì´ ì—†ìŒ
- **ìƒí™©**: ëª¨ë“  ê³¼ì œê°€ ë¯¸ì œì¶œ ìƒíƒœ
- **ì²˜ë¦¬**: "ì œì¶œí•œ ê³¼ì œê°€ ì—†ìŠµë‹ˆë‹¤." ë©”ì‹œì§€ í‘œì‹œ, ì´ì  0ì 

### 5. ì±„ì  ì™„ë£Œëœ ê³¼ì œê°€ ì—†ìŒ
- **ìƒí™©**: ì œì¶œí–ˆì§€ë§Œ ì•„ì§ ì±„ì ë˜ì§€ ì•ŠìŒ
- **ì²˜ë¦¬**: "ì±„ì  ì™„ë£Œëœ ê³¼ì œê°€ ì—†ìŠµë‹ˆë‹¤." ë©”ì‹œì§€ í‘œì‹œ

### 6. ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜
- **ìƒí™©**: BE í†µì‹  ì‹¤íŒ¨ (íƒ€ì„ì•„ì›ƒ, ì„œë²„ ì˜¤ë¥˜ ë“±)
- **ì²˜ë¦¬**: "ì„±ì ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”." ë©”ì‹œì§€ + ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ í‘œì‹œ

## Business Rules

### BR-001: Learnerë§Œ ì ‘ê·¼ ê°€ëŠ¥
- `role=learner`ì¸ ì‚¬ìš©ìë§Œ Learner ì„±ì  í˜ì´ì§€ ì ‘ê·¼ ê°€ëŠ¥
- `role=instructor`ëŠ” ë³¸ì¸ì´ ê°€ë¥´ì¹˜ëŠ” ì½”ìŠ¤ì˜ í•™ìŠµì ì„±ì ë§Œ ì¡°íšŒ ê°€ëŠ¥ (ë³„ë„ í˜ì´ì§€)

### BR-002: ë³¸ì¸ ì œì¶œë¬¼ë§Œ ì¡°íšŒ ê°€ëŠ¥
- `submissions` í…Œì´ë¸”ì—ì„œ `user_id = í˜„ì¬ ì‚¬ìš©ì ID`ì¸ ë ˆì½”ë“œë§Œ ì¡°íšŒ
- ë‹¤ë¥¸ í•™ìŠµìì˜ ì„±ì ì€ ì¡°íšŒ ë¶ˆê°€

### BR-003: ì±„ì  ì™„ë£Œëœ ì œì¶œë¬¼ë§Œ í‘œì‹œ
- `status = graded`ì¸ ì œì¶œë¬¼ë§Œ ì„±ì  í˜ì´ì§€ì— í‘œì‹œ
- `status = submitted` ë˜ëŠ” `status = resubmission_required`ëŠ” "ì±„ì  ëŒ€ê¸° ì¤‘" í‘œì‹œ

### BR-004: ì½”ìŠ¤ë³„ ì´ì  ê³„ì‚° ë°©ì‹
- ì´ì  = Î£(ê³¼ì œ ì ìˆ˜ Ã— ê³¼ì œ ë¹„ì¤‘ / 100)
- ì˜ˆ: ê³¼ì œ1(20% ë¹„ì¤‘, 90ì ) + ê³¼ì œ2(30% ë¹„ì¤‘, 85ì ) = 18 + 25.5 = 43.5ì 
- ë¯¸ì œì¶œ ê³¼ì œëŠ” ì´ì  ê³„ì‚°ì—ì„œ ì œì™¸ (ì œì¶œí•œ ê³¼ì œë§Œ í•©ì‚°)
- ì†Œìˆ˜ì  ë‘˜ì§¸ ìë¦¬ê¹Œì§€ í‘œì‹œ

### BR-005: ì§€ê° ì œì¶œ í‘œì‹œ
- `late = true`ì¸ ì œì¶œë¬¼ì€ "ì§€ê° ì œì¶œ" ë°°ì§€ í‘œì‹œ
- ì§€ê° ì œì¶œë¡œ ì¸í•œ ê°ì ì€ Instructorê°€ ì ìˆ˜ì— ë°˜ì˜ (ë³„ë„ ê°ì  í•„ë“œ ì—†ìŒ)

### BR-006: í”¼ë“œë°± í‘œì‹œ
- `feedback` í•„ë“œê°€ ìˆìœ¼ë©´ ì „ì²´ ë‚´ìš© í‘œì‹œ
- `feedback`ê°€ nullì´ë©´ "í”¼ë“œë°± ì—†ìŒ" í‘œì‹œ

### BR-007: ì •ë ¬ ë° í•„í„°ë§
- ê¸°ë³¸ ì •ë ¬: `graded_at` ë‚´ë¦¼ì°¨ìˆœ (ìµœê·¼ ì±„ì ëœ ìˆœì„œ)
- í•„í„°: ì½”ìŠ¤ë³„, ì ìˆ˜ ë²”ìœ„ë³„, ì§€ê° ì—¬ë¶€ë³„

---

## Sequence Diagram

```plantuml
@startuml
actor User
participant FE
participant BE
database Database

User -> FE: ì„±ì  í˜ì´ì§€ ì ‘ê·¼ (/learner/grades)

FE -> BE: GET /api/enrollments/me

BE -> BE: JWT í† í° ê²€ì¦

alt ì¸ì¦ ì‹¤íŒ¨
    BE -> FE: 401 Unauthorized
    FE -> User: ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
else ì¸ì¦ ì„±ê³µ
    BE -> BE: ì‚¬ìš©ì ì—­í•  í™•ì¸ (role=learner)

    alt ì—­í• ì´ learnerê°€ ì•„ë‹˜
        BE -> FE: 403 Forbidden
        FE -> User: Instructor ëŒ€ì‹œë³´ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
    else ì—­í• ì´ learner
        BE -> Database: SELECT * FROM enrollments\nWHERE user_id=:userId AND canceled_at IS NULL
        Database -> BE: í™œì„± ìˆ˜ê°• ëª©ë¡ ë°˜í™˜

        BE -> FE: 200 OK {enrollments: [...]}

        alt ìˆ˜ê°• ì¤‘ì¸ ì½”ìŠ¤ê°€ ì—†ìŒ
            FE -> User: "ìˆ˜ê°• ì¤‘ì¸ ì½”ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤" í‘œì‹œ
        else ìˆ˜ê°• ì¤‘ì¸ ì½”ìŠ¤ê°€ ìˆìŒ
            loop ê° ìˆ˜ê°• ì½”ìŠ¤ì— ëŒ€í•´
                FE -> BE: GET /api/courses/:courseId/assignments?status=published,closed
                BE -> Database: SELECT * FROM assignments\nWHERE course_id=:courseId AND status IN ('published', 'closed')
                Database -> BE: ê³¼ì œ ëª©ë¡ ë°˜í™˜
                BE -> FE: 200 OK {assignments: [...]}
            end

            FE -> BE: GET /api/submissions/me?status=graded

            BE -> Database: SELECT * FROM submissions\nWHERE user_id=:userId AND status='graded'
            Database -> BE: ì±„ì  ì™„ë£Œëœ ì œì¶œë¬¼ ëª©ë¡ ë°˜í™˜

            BE -> FE: 200 OK {submissions: [...]}

            alt ì±„ì  ì™„ë£Œëœ ê³¼ì œê°€ ì—†ìŒ
                FE -> User: "ì±„ì  ì™„ë£Œëœ ê³¼ì œê°€ ì—†ìŠµë‹ˆë‹¤" í‘œì‹œ
            else ì±„ì  ì™„ë£Œëœ ê³¼ì œê°€ ìˆìŒ
                FE -> FE: ê° ì½”ìŠ¤ë³„ ì´ì  ê³„ì‚°\nÎ£(ê³¼ì œ ì ìˆ˜ Ã— ë¹„ì¤‘ / 100)

                FE -> User: ì„±ì  UI í‘œì‹œ\n- ì½”ìŠ¤ë³„ ì„±ì  (ì´ì , ê³¼ì œ ê°œìˆ˜)\n- ê³¼ì œë³„ ì„±ì  (ì ìˆ˜, í”¼ë“œë°±, ì§€ê° ì—¬ë¶€)\n- ì „ì²´ ìš”ì•½ (í‰ê·  ì ìˆ˜, ì œì¶œ ì™„ë£Œ ìˆ˜)
            end
        end
    end
end

@enduml
```

---

## ì„±ì  ê³„ì‚° ë¡œì§ (ì˜ˆì‹œ)

```typescript
type GradedSubmission = {
  assignmentId: string;
  assignmentTitle: string;
  score: number;
  scoreWeight: number; // ê³¼ì œ ë¹„ì¤‘ (0-100)
  late: boolean;
  feedback: string | null;
  gradedAt: string;
};

type CourseGrade = {
  courseId: string;
  courseTitle: string;
  totalScore: number; // ì´ì 
  gradedCount: number; // ì±„ì  ì™„ë£Œëœ ê³¼ì œ ìˆ˜
  assignments: GradedSubmission[];
};

const calculateCourseGrade = (
  assignments: Assignment[],
  submissions: Submission[],
): CourseGrade => {
  // ì±„ì  ì™„ë£Œëœ ì œì¶œë¬¼ë§Œ í•„í„°ë§
  const gradedSubmissions = submissions.filter((s) => s.status === 'graded');

  // ê° ì œì¶œë¬¼ì˜ ê³¼ì œ ì •ë³´ ì¡°í•©
  const gradedAssignments: GradedSubmission[] = gradedSubmissions.map((submission) => {
    const assignment = assignments.find((a) => a.id === submission.assignmentId)!;
    return {
      assignmentId: assignment.id,
      assignmentTitle: assignment.title,
      score: submission.score!,
      scoreWeight: assignment.scoreWeight,
      late: submission.late,
      feedback: submission.feedback,
      gradedAt: submission.gradedAt!,
    };
  });

  // ì´ì  ê³„ì‚°: Î£(ì ìˆ˜ Ã— ë¹„ì¤‘ / 100)
  const totalScore = gradedAssignments.reduce((sum, item) => {
    return sum + (item.score * item.scoreWeight) / 100;
  }, 0);

  return {
    courseId: assignments[0]?.courseId || '',
    courseTitle: assignments[0]?.courseTitle || '',
    totalScore: Math.round(totalScore * 100) / 100, // ì†Œìˆ˜ì  ë‘˜ì§¸ ìë¦¬
    gradedCount: gradedSubmissions.length,
    assignments: gradedAssignments,
  };
};
```

---

## UI êµ¬ì„± (ì˜ˆì‹œ)

### ì½”ìŠ¤ë³„ ì„±ì  ì„¹ì…˜
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ React ê¸°ì´ˆ ê°•ì˜                  [43.5ì ]â”‚
â”‚ ì±„ì  ì™„ë£Œ: 2/3 ê³¼ì œ                     â”‚
â”‚                              [ìƒì„¸ ë³´ê¸°] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ React Hooks ê³¼ì œ             [18.0/20ì ]â”‚
â”‚ ì ìˆ˜: 90ì  | ë¹„ì¤‘: 20%                  â”‚
â”‚ ì œì¶œ: 2025-11-24 15:30 | ì±„ì : 11-25    â”‚
â”‚ í”¼ë“œë°±: "ë§¤ìš° ì˜ ì‘ì„±í•˜ì…¨ìŠµë‹ˆë‹¤..."     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ìƒíƒœ ê´€ë¦¬ í”„ë¡œì íŠ¸ ğŸ”´      [25.5/30ì ]â”‚
â”‚ ì ìˆ˜: 85ì  | ë¹„ì¤‘: 30% | ì§€ê° ì œì¶œ      â”‚
â”‚ ì œì¶œ: 2025-11-22 10:00 | ì±„ì : 11-23    â”‚
â”‚ í”¼ë“œë°±: "ì „ë°˜ì ìœ¼ë¡œ ì¢‹ìŠµë‹ˆë‹¤. ë‹¤ë§Œ..." â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì „ì²´ ìš”ì•½ ì„¹ì…˜
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì „ì²´ ìš”ì•½                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ í‰ê·  ì ìˆ˜: 87.5ì                        â”‚
â”‚ ì±„ì  ì™„ë£Œ: 5ê°œ ê³¼ì œ                     â”‚
â”‚ ì œì¶œ ì™„ë£Œ: 7ê°œ ê³¼ì œ                     â”‚
â”‚ ì§€ê° ì œì¶œ: 1ê°œ ê³¼ì œ                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
